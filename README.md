# Bot Tracker (Instagram + Telegram + FastAPI)

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–≤—è–∑–∫—É –∏–∑ Instagram-–±–æ—Ç–∞, backend API –∏ Telegram-–±–æ—Ç–∞.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—ã–¥–∞—á–∏ —Ç—Ä–µ–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Instagram —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π —á–µ—Ä–µ–∑ Telegram.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è **–¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Instagram**:
   - —á–µ—Ä–µ–∑ polling (instagrapi)
   - —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Instagram Graph API (webhook)

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **Instagram-–±–æ—Ç**

   **Polling (instagrapi)**
   - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ Reels
   - —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ (¬´—Ç—Ä–µ–∫–µ—Ä¬ª)
   - –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
   
   **Polling (instagrapi)** 
   - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç Meta —á–µ—Ä–µ–∑ HTTPS webhook
   - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞ Instagram

2. **Backend API**
   - —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–¥–∞—á–∏
   - —Å–ª—É–∂–∏—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
   - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

3. **Telegram-–±–æ—Ç**
   - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ deep-link
   - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API
   - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞
   - –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—ã–¥–∞—á–∏

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å—ã.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
bot-tracker/
‚îú‚îÄ‚îÄ logs/                           # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ tests/                          # –¢–µ—Å—Ç—ã (pytest)
‚îÇ   ‚îú‚îÄ‚îÄ test_instagram_webhook.py
‚îÇ   ‚îú‚îÄ‚îÄ test_instagram_bot.py
‚îÇ   ‚îî‚îÄ‚îÄ test_full_project.py
‚îÇ
‚îú‚îÄ‚îÄ telegram_bot.py                 # Telegram-–±–æ—Ç (aiogram)
‚îú‚îÄ‚îÄ instagram_bot.py                # Instagram-–±–æ—Ç (polling, instagrapi)
‚îú‚îÄ‚îÄ instagram_bot_graphs_api.py     # Instagram webhook (Graph API + FastAPI)
‚îú‚îÄ‚îÄ api_server.py                   # Backend API (FastAPI), —Ç–æ—á–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–æ–≤ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ database.py                     # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (SQLite)
‚îú‚îÄ‚îÄ logger.py                       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env                            # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

## ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* Python 3.11
* aiogram 3 ‚Äî Telegram-–±–æ—Ç
* instagrapi - Instagram polling-–±–æ—Ç
* Instagram Graph API ‚Äî webhook-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
* FastAPI ‚Äî backend API –∏ webhook
* SQLite ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
* httpx / requests ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç—ã
* python-dotenv ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
* pytest ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
* logging ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
* Cloudflare Tunnel ‚Äî HTTPS-–¥–æ—Å—Ç—É–ø –¥–ª—è webhook

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ SQLite.

–§–∞–π–ª:

```
database.py
```

–¢–∞–±–ª–∏—Ü–∞ users —Å–æ–¥–µ—Ä–∂–∏—Ç:

* instagram_username
* telegram_user_id
* is_subscribed
* tracker_sent_at
* logs

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î:

```
python database.py
```

---

## Instagram (polling-–±–æ—Ç)

–§–∞–π–ª:

```
instagram_bot.py
```

–ó–∞–¥–∞—á–∏:

* –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–¥ Reels
* —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
* —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
* –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏ –≤ Direct (deep-link –≤ Telegram)

‚ö†Ô∏è –í —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö Instagram –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–æ—Ç–æ–≤.
–ü—Ä–æ–µ–∫—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ mock-—Ç–µ—Å—Ç—ã –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

---

## Instagram (webhook, Graph API)

–§–∞–π–ª:

```
instagram_bot_graphs_api.py
```

–ó–∞–¥–∞—á–∏:

* –ø—Ä–∏—ë–º webhook-—Å–æ–±—ã—Ç–∏–π –æ—Ç Meta
* –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è webhook (hub.challenge)
* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
* –æ—Ç–ø—Ä–∞–≤–∫–∞ DM —á–µ—Ä–µ–∑ Graph API (–∏–ª–∏ mock-—Ä–µ–∂–∏–º) ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Instagram-—Ç–æ–∫–µ–Ω–∞
* –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API

Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HTTPS (–Ω–∞–ø—Ä–∏–º–µ—Ä, Cloudflare Tunnel)
–∏ –≥–æ—Ç–æ–≤ –∫ production-—Å—Ü–µ–Ω–∞—Ä–∏—è–º.

## Telegram-–±–æ—Ç

–§–∞–π–ª:

```
telegram_bot.py
```

–õ–æ–≥–∏–∫–∞:

* –æ–±—Ä–∞–±–æ—Ç–∫–∞ /start
* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ deep-link –≤–∏–¥–∞ insta_<username>
* –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
* —Ñ–∏–∫—Å–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞
* –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—ã–¥–∞—á–∏

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env:

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_BOT_LINK=https://t.me/instagram_tele_tracker_bot

# Backend API
API_BASE_URL=http://localhost:8000

# Instagram (polling)
INSTAGRAM_USERNAME=your_account_username
INSTAGRAM_PASSWORD=your_account_password

# Instagram (webhook)
IG_VERIFY_TOKEN=your_verify_token
IG_PAGE_ACCESS_TOKEN=optional_for_dev

# –ü—Ä–æ—á–µ–µ
TARGET_REELS_ID=your_reels_id
```

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
pip install -r requirements.txt
```

2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
python database.py
```

3. –ó–∞–ø—É—Å–∫ backend API

```
uvicorn api_server:app --reload
```

4. –ó–∞–ø—É—Å–∫ Instagram polling-–±–æ—Ç–∞

```
python instagram_bot.py
```

5. –ó–∞–ø—É—Å–∫ Instagram webhook

```
uvicorn instagram_bot_graphs_api:app --host 0.0.0.0 --port 8000
```

6. –ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞

```
python telegram_bot.py
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã—Ç unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ mock-—Ç–µ—Å—Ç–∞–º–∏.

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```
pytest
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:

* –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é webhook
* –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
* –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
* –∑–∞—â–∏—Ç—É –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—ã–¥–∞—á–∏
* —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è MVP

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

* –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞ (logger.py)
* –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ –ø–∞–ø–∫—É logs/
* –§–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—à–∏–±–∫–∏

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

* –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ webhook
* Named Cloudflare Tunnel
* Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
* Retry-–º–µ—Ö–∞–Ω–∏–∑–º—ã
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP-–∫–ª–∏–µ–Ω—Ç—ã
* CI/CD
* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

---

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

MVP –≥–æ—Ç–æ–≤ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏.
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç webhook-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ production-–Ω–∞–≥—Ä—É–∑–∫–µ.